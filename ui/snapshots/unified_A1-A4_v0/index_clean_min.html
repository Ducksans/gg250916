<!doctype html>
<html lang="ko" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" /></head>
    <title>금</title>강 UI — index_clean_min.html (A1–A4 Minimal)</title>
    <style></style>
      :root {
        --bg: #0b0c10;
        --fg: #e5e7eb;
        --muted: #94a3b8;
        --accent: #22c55e;
        --border: #1f2937;
        --panel: #111827;
      }
      html[data-theme="light"] {
        --bg: #f8fafc;
        --fg: #0f172a;
        --muted: #475569;
        --accent: #16a34a;
        --border: #e5e7eb;
        --panel: #ffffff;
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        color: var(--fg);
        background: var(--bg);
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif;
        line-height: 1.5;
      }

      header {
        position: sticky;
        top: 0;
        z-index: 10;
        background: var(--panel);
        border-bottom: 1px solid var(--border);
      }
      .hdr {
        max-width: 1060px;
        margin: 0 auto;
        padding: 12px 14px 8px;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 8px;
        align-items: center;
      }
      .title { margin: 0; font-size: 18px; }
      .toolbar { display: inline-flex; gap: 8px; align-items: center; }

      .btn {
        appearance: none;
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--fg);
        border-radius: 8px;
        padding: 8px 10px;
        font-size: 13px;
        cursor: pointer;
      }
      .btn:focus-visible { outline: 2px solid rgba(34, 197, 94, 0.35); outline-offset: 2px; }

      .diag {
        grid-column: 1 / -1;
        margin: 0;
        color: var(--muted);
        font-size: 12px;
        white-space: pre-wrap;
      }

      nav.tabs {
        max-width: 1060px;
        margin: 0 auto;
        display: flex;
        gap: 8px;
        padding: 8px 14px 10px;
        border-top: 1px solid transparent;
        border-bottom: 1px solid var(--border);
        background: var(--panel);
      }
      nav.tabs a {
        display: inline-block;
        padding: 8px 10px;
        font-size: 13px;
        color: var(--fg);
        text-decoration: none;
        border: 1px solid var(--border);
        border-radius: 10px;
        background: var(--panel);
      }
      nav.tabs a[aria-current="page"] {
        outline: 1px solid rgba(34, 197, 94, 0.45);
      }

      main { max-width: 1060px; margin: 0 auto; padding: 14px; }
      section.panel {
        display: none;
        padding: 14px;
        border: 1px solid var(--border);
        border-radius: 12px;
        background: var(--panel);
      }
      html[data-theme="light"] section.panel { background: #ffffff; }
      section.panel.active { display: block; }
      section.panel h2 { margin: 0 0 8px; font-size: 16px; }
      section.panel p { margin: 0; color: var(--muted); font-size: 14px; }

      .grid {
        display: grid;
        grid-template-columns: max-content 1fr;
        gap: 6px 12px;
        align-items: baseline;
      }
      .label { color: var(--muted); font-size: 13px; }
      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 13px; word-break: break-all; }
      .row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }

      footer {
        max-width: 1060px;
        margin: 18px auto 26px;
        padding: 0 14px;
        color: var(--muted);
        font-size: 12px;
        display: flex;
        gap: 12px;
        justify-content: space-between;
        flex-wrap: wrap;
      }

      dialog#kbd-help {
        border: none;
        border-radius: 12px;
        padding: 14px 16px;
        background: var(--panel);
        color: var(--fg);
        width: min(560px, 92vw);
      }
      dialog#kbd-help::backdrop { background: rgba(0, 0, 0, 0.45); }
      .kbd-grid {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 6px 10px;
        font-size: 14px;
      }
      .kbd {
        background: transparent;
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 2px 6px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        font-size: 12px;
      }
    </style>
  </head>
  <body></body>
    <header></header>
      <div class="hdr">
        <h1 class="title">금강 UI — index_clean_min.html</h1>
        <div class="toolbar" role="toolbar" aria-label="View controls">
          <button id="btn-theme" class="btn" type="button" title="테마 토글 (T)">다크</button>
          <button id="btn-help" class="btn" type="button" title="단축키 도움말 (?)">도움말</button>
        </div>
        <p id="diag" class="diag" aria-live="polite">
• 최소 UI(탭/테마/단축키/세션메타)
• 쿼리 예: ?session=GG-SESS-20250816-2249&date=20250816&version=v0
• 단축키: [1–4]=탭, Ctrl+←/→=탭이동, T=테마, ?=도움말, Esc=닫기
        </p>
      </div>
      <nav class="tabs" aria-label="A1–A4 Tabs">
        <a href="#a1" id="tab-a1">A1 — 채팅</a>
        <a href="#a2" id="tab-a2">A2 — 세션/태스크</a>
        <a href="#a3" id="tab-a3">A3 — 도구 패널</a>
        <a href="#a4" id="tab-a4">A4 — 상태/로그</a>
      </nav>
    </header>

    <main></main>
      <noscript></noscript>
        <p class="label">브라우저에서 JavaScript가 꺼져 있습니다. 주소창의 #a1~#a4 해시로 패널을 이동하세요.</p>
      </noscript>

      <section id="a1" class="panel active" aria-labelledby="tab-a1">
        <h2>A1 — 채팅(Chat)</h2>
        <p>렌</p>더링 검증용 최소 UI입니다. 모델/도구 호출은 없습니다.</p>
      </section>

      <section id="a2" class="panel" aria-labelledby="tab-a2">
        <h2>A2 — 세션/태스크</h2>
        <div class="grid" id="session-card" style="margin-top:6px;">
          <div class="label">SESSION_ID</div><div id="meta-session" class="mono">-</div>
          <div class="label">CAPTURE_DATE</div><div id="meta-date" class="mono">-</div>
          <div class="label">SNAPSHOT</div><div id="meta-version" class="mono">v0</div>
          <div class="label">screenshots</div><div id="meta-path" class="mono">-</div>
        </div>
        <div class="row" style="margin-top:10px;">
          <button id="btn-copy-meta" class="btn" type="button" title="세션 메타 복사">메타 복사</button>
        </div>
      </section>

      <section id="a3" class="panel" aria-labelledby="tab-a3">
        <h2>A3 — 도구 패널</h2>
        <p>토</p>크나이저/내보내기 등은 비활성화. 레이아웃 확인만 목적입니다.</p>
      </section>

      <section id="a4" class="panel" aria-labelledby="tab-a4">
        <h2>A4 — 상태/로그</h2>
        <p></p>좌측 상단의 도움말(?)을 참고하세요. 상태 라인은 하단에 표시됩니다.</p>
      </section>
    </main>

    <footer></footer>
      <div id="status" aria-live="polite">Ready.</div>
      <div id="ts" aria-label="Rendered timestamp" class="mono"></div>
    </footer>

    <dialog id="kbd-help" aria-label="Keyboard shortcuts">
      <form method="dialog" style="margin:0;">
        <h3 style="margin:0 0 8px; font-size:16px;">단축키</h3>
        <div class="kbd-grid">
          <div class="kbd">1 / 2 / 3 / 4</div><div></div>각 탭으로 이동</div>
          <div class="kbd">Ctrl + ← / →</div><div></div>이전/다음 탭</div>
          <div class="kbd">T</div><div></div>다크/라이트 테마 토글</div>
          <div class="kbd">?</div><div></div>도움말 열기/닫기</div>
          <div class="kbd">Esc</div><div></div>대화상자 닫기</div>
        </div>
        <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px;">
          <button class="btn" value="cancel" type="submit">닫기 (Esc)</button>
        </div>
      </form>
    </dialog>

    <script></script>
      (function () {
        "use strict";

        // Helpers
        function $(sel) { return document.querySelector(sel); }

        // Tabs
        var ORDER = ["#a1", "#a2", "#a3", "#a4"];
        var VALID = ORDER.reduce(function (m, h) { m[h] = true; return m; }, {});
        var DEFAULT_HASH = "#a1";

        function setStatus(msg) { var el = $("#status"); if (el) el.textContent = msg; }

        function activate(hash) {
          var h = hash || location.hash || DEFAULT_HASH;
          if (!VALID[h]) h = DEFAULT_HASH;

          // Panels
          ORDER.forEach(function (id) {
            var sec = $(id);
            if (sec) sec.classList.toggle("active", id === h);
          });

          // Tabs aria-current
          ORDER.forEach(function (id) {
            var tab = $("#tab-" + id.slice(1));
            if (!tab) return;
            if (id === h) tab.setAttribute("aria-current", "page");
            else tab.removeAttribute("aria-current");
          });

          try { history.replaceState(null, "", h); } catch (_) { /* fallback: ignore */ }
          setStatus("탭 전환: " + h.toUpperCase().slice(1));
        }

        // Theme
        var THEME_KEY = "gg_theme";
        function prefersDark() {
          return window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
        }
        function applyTheme(theme) {
          var t = theme || localStorage.getItem(THEME_KEY) || (prefersDark() ? "dark" : "light");
          document.documentElement.setAttribute("data-theme", t);
          localStorage.setItem(THEME_KEY, t);
          var btn = $("#btn-theme");
          if (btn) btn.textContent = (t === "dark" ? "다크" : "라이트");
          setStatus("테마: " + (t === "dark" ? "Dark" : "Light"));
        }
        function toggleTheme() {
          var cur = document.documentElement.getAttribute("data-theme") || "dark";
          applyTheme(cur === "dark" ? "light" : "dark");
        }

        // Session meta
        function yyyymmdd(d) {
          var y = d.getFullYear();
          var m = String(d.getMonth() + 1).padStart(2, "0");
          var dd = String(d.getDate()).padStart(2, "0");
          return "" + y + m + dd;
        }
        function parseQuery() {
          var q = new URLSearchParams(location.search);
          return {
            session: (q.get("session") || "GG-SESS-UNKNOWN").trim(),
            date: (q.get("date") || yyyymmdd(new Date())).trim(),
            version: (q.get("version") || "v0").trim()
          };
        }
        function renderSessionMeta() {
          var meta = parseQuery();
          var path = "gumgang_meeting/ui/logs/ui_unified_" + meta.date + "_" + meta.version + "_" + meta.session + "/screenshots/";

          var s = $("#meta-session"), d = $("#meta-date"), v = $("#meta-version"), p = $("#meta-path");
          if (s) s.textContent = meta.session;
          if (d) d.textContent = meta.date;
          if (v) v.textContent = meta.version;
          if (p) p.textContent = path;

          var btn = $("#btn-copy-meta");
          if (btn) {
            btn.onclick = function () {
              var text = [
                "SESSION_ID=" + meta.session,
                "DATE=" + meta.date,
                "VERSION=" + meta.version,
                "SCREENSHOTS=" + path
              ].join("\n");
              navigator.clipboard.writeText(text)
                .then(function () { setStatus("세션 메타를 클립보드로 복사했습니다."); })
                .catch(function () { setStatus("클립보드 복사 실패. 권한을 확인하세요."); });
            };
          }
        }

        // Help dialog
        var help = $("#kbd-help");
        function toggleHelp() { if (!help) return; if (help.open) help.close(); else help.showModal(); }

        // Keyboard
        function isEditableTarget(t) {
          return !!t && (t.tagName === "INPUT" || t.tagName === "TEXTAREA" || t.isContentEditable);
        }
        function gotoIndex(i) {
          var L = ORDER.length;
          var idx = ((i % L) + L) % L;
          activate(ORDER[idx]);
        }

        // Init
        document.addEventListener("DOMContentLoaded", function () {
          var themeBtn = $("#btn-theme");
          var helpBtn = $("#btn-help");
          if (themeBtn) themeBtn.addEventListener("click", toggleTheme);
          if (helpBtn) helpBtn.addEventListener("click", toggleHelp);

          var ts = $("#ts");
          if (ts) ts.textContent = "Rendered at: " + new Date().toISOString();

          applyTheme();
          renderSessionMeta();
          if (!location.hash || !VALID[location.hash]) {
            try { history.replaceState(null, "", DEFAULT_HASH); } catch (_) { /* ignore */ }
          }
          activate();

          window.addEventListener("hashchange", function () { activate(); });

          window.addEventListener("keydown", function (e) {
            if (isEditableTarget(e.target)) return;

            if (e.key === "?" || (e.shiftKey && e.key === "/")) { e.preventDefault(); toggleHelp(); return; }
            if (e.key === "t" || e.key === "T") { e.preventDefault(); toggleTheme(); return; }
            if (/^[1-4]$/.test(e.key)) { e.preventDefault(); gotoIndex(parseInt(e.key, 10) - 1); return; }
            if (e.ctrlKey && (e.key === "ArrowLeft" || e.key === "ArrowRight")) {
              e.preventDefault();
              var cur = ORDER.indexOf(VALID[location.hash] ? location.hash : DEFAULT_HASH);
              gotoIndex(cur + (e.key === "ArrowRight" ? 1 : -1));
              return;
            }
            if (e.key === "Escape" && help && help.open) { e.preventDefault(); help.close(); }
          });
        });
      })();
    </script>
  </body>
</html>
