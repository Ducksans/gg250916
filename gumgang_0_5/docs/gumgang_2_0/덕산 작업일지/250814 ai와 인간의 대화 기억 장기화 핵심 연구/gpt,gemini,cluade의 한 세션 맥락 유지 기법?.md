## “기억 없음”을 “기억 있는 것처럼” 보이게 만드는 일반 원리

대기업들이 쓰는 방식은 거의 다 **“외부 기억 + 일시적 요약”** 조합입니다.  
모델(LLM) 자체의 가중치를 바꾸지 않고, **대화 이력·요약·사용자 설정을 바깥 저장소에 보관**한 뒤, 다음 요청 때 **필요한 조각만 엄선해 모델 앞쪽에 다시 붙여 넣는** 패턴이죠.

### 1) 세션/스레드 저장 (Short-term)

- **대화 ID(thread_id)** 단위로 메시지를 서버 DB에 저장.
    
- 다음 턴 요청 시, 최근 N턴(또는 요약)을 **프롬프트 앞부분**에 재주입.
    
- 쿠키/토큰/계정으로 스레드 식별. 브라우저 새로 열어도 같은 스레드면 이어짐.
    

예시(개념용):

`POST /chat {   "thread_id": "th_9a1...",   "messages": [     {"role":"system","content":"프로젝트 규칙 ..."},     {"role":"assistant","content":"지난 요약: ..."},  // 서버가 첨부     {"role":"user","content":"어제 어디까지 했지?"}   ] }`

### 2) 요약(Summarization) & 압축(Context distillation)

- 대화가 길어지면 **요약문(“리캡”)**을 만들고, 오래된 원문은 보관만 하거나 아예 요약으로 대체.
    
- 매 턴 “최근 3~~10개 메시지 + 누적 요약 1~~2개” 정도만 모델로 보냄 → **토큰 절약 + 맥락 유지**.
    

### 3) 검색증강(RAG) (Mid/Long-term)

- 스레드 밖의 노트/문서/태스크/사용자 메모를 **벡터DB에 임베딩**으로 저장.
    
- 질의 들어오면 **의미 유사 문서**를 몇 개 골라 **컨텍스트로 추가**.
    
- “며칠간 대화 흐름”도 요약/키포인트를 임베딩해 필요할 때만 꺼냄.
    

### 4) 개인화 메모리(옵트인)

- 사용자 취향·고정 설정(단축키 선호, 언어, 작업 스타일 등)을 **계정별 메모**로 따로 저장.
    
- 다음 대화에서 **시스템/어시스턴트 프롬프트 앞부분**에 짧게 삽입(“이 사용자는 KST, 다크모드 선호” 같은).
    

### 5) 정책/가드레일(시스템 프롬프트)

- 제품 전체 공통 규칙(안전/톤/역할)을 **시스템 메시지**로 항상 첨부.
    
- 드리프트를 줄이고 응답 일관성 확보.
    

---

## 왜 “기억 있는 것처럼” 느껴지나?

- **모델의 장기기억이 생긴 게 아니라**,  
    서버가 **(1) 요약/검색으로 필요한 맥락을 찾아주입**하고,  
    **(2) 계정/스레드로 문맥을 이어주기** 때문이에요.
    

---

## 로컬에서 재현하려면(금강 관점, 초간단 버전)

1. **스레드 저장소**: `threads/{id}.jsonl`에 대화 로그 저장.
    
2. **요약 파일**: 턴 수가 임계치 넘으면 `threads/{id}.summary.md` 갱신.
    
3. **벡터 인덱스**: `notes/`, `docs/`를 임베딩 → 질의 시 상위 k개를 프롬프트에 첨부.
    
4. **개인 메모**: `profile/memory.json`에 고정 선호/환경 저장 → 매 호출 시 시스템 앞에 삽입.
    
5. **자동 리캡 트리거**: “아까/어디까지/계속” 감지 → 최근 요약 1~3줄 자동 첨부 후 확인 질문.
    

---

## 가장 흔한 오해 2가지

- **모델이 스스로 기억한다?** ❌  
    → 대부분은 **외부 저장소**가 기억을 맡고, **모델은 매번 “주입”** 받습니다.
    
- **며칠 지나도 이어주는 건 파인튜닝?** ❌  
    → 제품 계정/세션 레이어에서 **요약·검색·메모를 재주입**하는 겁니다.
    

---

## 한 줄 요약

> “웹 UI가 기억하는 것처럼 보이는 비밀” = **스레드 저장 + 요약 + RAG + 개인 메모 + 시스템 규칙**을 **요청 때마다 앞에 붙여 넣는** 제품 아키텍처입니다.  
> 모델은 매번 “기억 없음”으로 시작해도, **외부 메모리가 ‘기억의 환상’을 정확하게 제공**해 주는 거죠.