# Gumgang Meeting — Root README

This is the top-level guide for running and developing the Gumgang Meeting stack in BT-10 (meeting capture, annotate, record). It highlights fixed ports, minimal dependencies, virtual environment hygiene, preflight checks, and quick start commands.

Status
- Core UI is served by the Bridge on port 3037.
- Meeting backend (FastAPI) runs on port 8000.
- A1/A5 UI buttons are wired to backend endpoints.
- Evidence is written under status/evidence/**.

Ports & Entrypoints (fixed by rules v3.0)
- Bridge (UI + file ops): http://localhost:3037 (node bridge/server.js)
  - Static UI at /ui/ (default: /ui/snapshots/unified_A1-A4_v0/index.html)
  - APIs: /api/save, /api/open, /api/fs/*, /api/health
- Backend (meeting features): http://127.0.0.1:8000 (uvicorn app.api:app)
  - Health: GET /api/health
  - Capture: POST /api/meetings/capture
  - Capture(upload): POST /api/meetings/capture/upload
  - Annotate: POST /api/meetings/annotate
  - Record start/stop: POST /api/meetings/record/start, /record/stop
  - Events read: GET /api/meetings/{meetingId}/events

Authoritative env file
- gumgang_meeting/.env (rules v3.0)
- Bridge also reads certain variables (e.g., READ_ONLY_MODE, FS_ALLOWLIST).

Dependencies (dev environment)
- Node.js >= 18 (to run the Bridge; server.js uses only built-in modules)
- Python >= 3.10 (tested with 3.12) with venv support (python3-venv on Debian/Ubuntu)
- Python packages (installed into project-local venv):
  - fastapi >= 0.110
  - uvicorn[standard] >= 0.23
  - python-multipart >= 0.0.9

Never install Python packages globally on system Python (PEP 668). Use the provided venv helper.

Project structure (key paths)
- bridge/server.js — Bridge (3037). Serves UI and provides /api/save, /api/open, /api/health.
- ui/snapshots/unified_A1-A4_v0/index.html — Main UI snapshot (overlays auto-injected if present).
- ui/overlays/active.css, ui/overlays/active.js — Hot-reload overlays (optional).
- app/api.py — FastAPI backend (8000) for meeting capture/annotate/record.
- scripts/dev_backend.sh — venv helper for backend: init/run/health/freeze/env.
- scripts/preflight.sh — Preflight: venv existence/deps, port conflicts (3037, 8000).
- status/evidence/** — Evidence outputs (freeze snapshots, meeting events, etc.).
- status/checkpoints/CKPT_72H_RUN.md — Single source of truth for checkpoints.

Quick start (recommended)
1) Preflight (checks venv + ports)
   ./scripts/preflight.sh
   # Optional machine-readable:
   ./scripts/preflight.sh --json

2) Backend venv setup and run
   chmod +x scripts/dev_backend.sh
   ./scripts/dev_backend.sh init
   ./scripts/dev_backend.sh run
   # Health:
   ./scripts/dev_backend.sh health

3) Run Bridge (in another terminal)
   node bridge/server.js
   # Health:
   curl -s http://localhost:3037/api/health

4) Open UI and test
   - Browser: http://localhost:3037/ui/
   - A2 탭의 Session에 세션ID 입력(없으면 GG-SESS-LOCAL 사용).
   - A5 탭 또는 A1 퀵패널에서 캡쳐/주석/녹화 버튼 클릭.
   - 이벤트 확인:
     curl -s "http://127.0.0.1:8000/api/meetings/<세션ID>/events" | jq

Evidence and reproducibility
- Freeze snapshot (pip freeze + runtime info) is written by:
   ./scripts/dev_backend.sh freeze
  → status/evidence/packaging/dev_backend_freeze_*.txt
- Venv hygiene guide (full details):
  status/evidence/packaging/venv_hygiene_guide_20250820.md

UI overlay notes
- UI auto-loads overlays if files exist:
  - /ui/overlays/active.css
  - /ui/overlays/active.js
- You can toggle overlays without rebuild; they are HEAD-probed and injected by index.html.

Bridge API quick tips
- Save
   curl -sS -X POST http://localhost:3037/api/save \
     -H "Content-Type: application/json" \
     -d '{"root":"status","path":"evidence/demo.txt","content":"hello","overwrite":true,"ensureDirs":true}'
- Open
   curl -sS -X POST http://localhost:3037/api/open \
     -H "Content-Type: application/json" \
     -d '{"root":"status","path":"evidence/demo.txt"}'

Backend API quick tips
- Health
   curl -s http://127.0.0.1:8000/api/health
- Capture (JSON)
   curl -sS -X POST http://127.0.0.1:8000/api/meetings/capture \
     -H "Content-Type: application/json" \
     -d '{"meetingId":"GG-SESS-LOCAL","note":"manual test","payload":{"source":"curl"}}'
- Events tail
   curl -s "http://127.0.0.1:8000/api/meetings/GG-SESS-LOCAL/events?limit=50"

Preflight (details)
- Checks for:
  - Project venv availability at ./venv
  - Python deps: fastapi, uvicorn, multipart
  - Port conflicts on 3037 (Bridge) and 8000 (Backend)
- Usage:
   chmod +x scripts/preflight.sh
   scripts/preflight.sh
- If a port is in use, free it or run with overrides (document any overrides in a checkpoint).

Venv policy (cleanliness)
- Exactly one venv at project root: ./venv
- Do not create nested envs under gumgang_0_5/** etc.
- Avoid system-level pip installs; use venv or pipx.
- Record environment with ./scripts/dev_backend.sh freeze when dependencies change.

Troubleshooting
- “externally-managed-environment” (PEP 668)
  - Use venv: ./scripts/dev_backend.sh init
- uvicorn not found
  - Run from venv: ./scripts/dev_backend.sh run
- Port already in use
  - Identify listener (ss/lsof/netstat) and stop, or override:
    PORT_BACKEND=8010 ./scripts/preflight.sh
    HOST=127.0.0.1 PORT=8010 ./scripts/dev_backend.sh run
  - If you override ports, record a checkpoint entry per rules v3.0.
- CORS issues
  - Backend enables permissive CORS for localhost and tauri://localhost by default; see app/api.py.

Security
- Bridge has no auth; use on trusted networks only.
- All path writes via Bridge are constrained to allowed roots and normalized to prevent traversal.

References
- Rules v3.0: gumgang_meeting/.rules (ports, evidence, checkpoints, non‑negotiables)
- Bridge docs: gumgang_meeting/bridge/README.md
- Backend app: gumgang_meeting/app/api.py

Happy building!